# 2023 GDKOI 游记

## DAY0

​	中午坐大巴车去广州，开心，因为可以逃课、撬周测。车上聊了一路。来的路上看见了好多奶茶店，晚上准备和同学一起出去炫奶茶。路上还有好多摩天大楼、购物中心、繁华的建筑，向往之情油然而生。

​	到了酒店还算满意，就是给的东西有点少，牙刷少了一套。酒店机器人真的nb，能自动送货，还能自己开电梯，不愧是大城市。下午在jc的房间打王者，美好而短暂。

​	去到了六中，被震惊了。庞大的校园，高耸的教学楼，高科技教学方式，千人会议室……我的梦中情校。就凭开始就送袋子、笔记本、笔，好感直接上升，我觉得至少这一千块钱没有白花。而且食堂还不错，伙食肯定比sx强，加饭还送咖喱酱，我感觉值了。

​	吃完晚饭后回去洗完澡就出酒店了，蜜雪冰城首选。四个人31RMB，和赖总AA，还算便宜。顺路还买了点面包，但我是真的不知道3片面包买12块是什么逻辑。中间炫了一份甜筒、一杯蜜雪的新品，不得不说，蜜雪的新品的芋圆真好吃！但是我好饱，因为炫了一份晚餐，还加了饭，后面还炫奶茶。

​	酒店旁的美宜佳买了两幅扑克牌play。回酒店后，在708打了会牌，到22:00查房后就回去睡觉了。但是我好饱睡不着！！！

## DAY1

​	淦，昨天没睡好，起来贼困一个。

​	莫名其妙昨天躺下后睡不着，然后就干着急。应该是吃的太饱了，躺在床上的强烈饱腹感让我翻来覆去。上了若干次厕所没用，看来Cold_Chair大法不适合用来睡觉。还是谨慎使用。之后就在想不睡觉会不会影响自己明天的比赛，直到听见时间是0:00时，意识到现在睡还来得及，直接睡。但睡得也不好，中间总是醒来，翻身，处于那种迷迷蒙蒙，半醒半睡的状态。直达有人敲门叫我们起床。我都不知是睡到天亮了还是躺到了天亮。

​	不管了，跟着大部队去到了考场。

​	在考场外呆了好久，和其他dalao讨论了一会电脑是Win7还是Win10，进考场。

### DAY1比赛情况

#### 赛时

​	笑死，密码竟然是HAOJIUBUJIAN，电脑真的是Win7！

​	屏幕分辨率真的恶心，拉伸的好长。还有就是GDB用不了，直接不能调试，之后就慌了，因为没有GDB，对比比赛来说就会有巨大影响。为此，我还去D盘中的编程软件安装了一个5.2的DEV，然后发现用不了，换成了之前5.1的DEV。搞完这些屁事之后，都过了15min了。但很快就进入比赛状态。

​	好家伙，三道题都有998244353，其中还有两道计数题。真的不理解出题人在干什么。

​	T1前面的40pts很好想，但是后面的就不会了。后面想到了随机撒点，大致想法是这样的：

​	既然都没办法做到 $O(qn^3)$ ，并且判一个点是 $O(n)$ 的，那我就判 $n^2$ 个点中的一些点。如果在这些点之中有不匹配的，就NO；一个没有就YES。

​	想到这个因为数据的 $q,\sum n \le 3000$ ，所以，$O(qn^2)$ 没问题。我算了一下，$500^3=1.25e8$，大约是1.25s，虽然说有 O2 和 2s 时限，但我当时还是很慌，于是在 $n\ge 500$ 时撒点，撒 $5n+100$ 个点，$O(q \cdot (5n^2+100n))=O(qn^2)$ 应该不会GG。

​	在比赛进行了2h打完，其中有20min思考，大约1h调。我真的服了，因为一个重在运算符的问题调了我好久，一共打了144行，2000多bytes。

​	搞完之后匆匆忙忙的看T2，因为有比赛经验，所以并没有在T1耗很久。T2肯定想不到正解，于是开始想 subtask2 的10pts。

​	考虑容斥。其中有 1、2、3、……、n 人可以在原位置，其他人乱排，于是就有
$$
\text{ans}=n!-\sum_{i=1}^{n} (-1)^{i-1}\cdot C_{n}^{i} \cdot (n-i)!
$$
​	对拍了一下，发现是对的。欢天喜地，还妄想推出后面的subtask的答案。发现推不出来，于是快乐的打起20pts的程序。

​	T3本来想打暴力的，然后算错时间复杂度，以为连subtask1都过不去，于是无语。最后还是打了一个暴力，之后比赛结束。

#### 赛后

​	晕，T1听见dalao说是原题，直接凉凉。好像是GMOJ上的一道原题。qwq

​	T1 TN说自己好像能AC，中午回酒店的时候又听见绿老师也AC了，直接再见铜奖。

​	哈哈，T3暴力有20pts，只是我算错时间复杂度了。T2自我感觉良好，因为好像挺多人都没想出来subtask2怎么打。

​	但是好景不长，下听讲座的时候忽然想到T2的组合数和阶乘是每问一次做一次的，没有预处理，直接 $O(qn) \to O(qn^2),20pts\to 10pts$。

​	讲座真的好无聊。那个小马智行好像挺有意思的，不过打不到车，因为没手机。罗国杰教授的高级抠图把好多人整笑了。

​	中间要跑榜又不跑，说什么：“我们已经测试完了，但有些人测试很多次都不一样，为了你们开心，只好多跑几次”。真无语，能不能给句痛快话。又说吃完饭之后跑，吃完饭后又说明天再见……

#### 旅游情况

​	先去吃了个MacDonald，3个人，每人一份hamburger、chip、cola，一共92RMB，又是跟赖总AA。然后我喝了蜜雪的柠檬水，好\*\*难喝。

​	吃完之后TN说要去看看中大，买点纪念品，于是往左一直走。中大没去成，但去到了珠江岸边，欣赏到了广州的繁华。

​	一艘艘观光船，快速的在河面游过，留下巨大的广告牌的残影，一开始距离有点远的时候，我们还以为是一种跑得飞快的公交车。还有对岸的高楼大厦，五彩斑斓的灯光，都让我感觉是来旅游的。

​	这里谢谢绚丽多彩的霓虹灯吧。以黄色为主调的灯光照射在建筑物上，反射出来的景象，是一种柔和的感觉。被程序控制的灯管一闪一闪，富有节奏感的动画在眼前展开。并且高楼还不知一栋，前方许多建筑紧挨着。

​	顺便拍了点照片，看到了小蛮腰。

​	之后就回酒店，回酒店的路上，我看见了到处的地摊、到处都是的餐馆、小小的商店，体会到了真正的人间烟火，不禁感慨，广州真是一个世间繁华和人间烟火并存的城市啊。回到酒店后，把作文写完，打了会扑克，就睡去。

## DAY2

​	昨天睡得还不错，至少比DAY1强。因为吃的没那么饱。

### 比赛情况

#### 赛时

​	TN说可以调分辨率，试着做了一下，写代码感觉好多了。

​	看完题用了15min，感觉T1、T3有点意思，subtask很多，可以试试。

​	开始想T1。发现 $O(qn^3)$ 过不了subtask1，考虑优化成 $O(qn^2)$。莫名其妙就想到了树剖，想着枚举每一个重链的链底作为 $u$ ，然后枚举 $v,w$ ，感觉像是 $O(qn^2)$的，但想了想，发现是虚伪的时间复杂度，又看见subtask2是 $O(qn)$ 的，又考虑优化。

​	首先，对于树上的三个点 $(u,v,w)$ ，它们的路径 $(u,v),(u,w),(v,w)$ ，必然有一个公共交点，类似于这样

![1](.\p1.png)

​	那么，他们的路径就会有重复，设公共节点为 $i$ ，再设 $dis(u,i)=A,dis(v,i)=B,dis(w,u)=C$，就有
$$
\begin{cases}
A+B=x \\ 
A+C=y \\
B+C=z \\
\end{cases}
$$
![2](.\p2.png)

​	解一下，就是
$$
\begin{cases}
A=\dfrac{y+z-x}{2} \\
B=\dfrac{x+z-y}{2} \\
C=\dfrac{x+y-z}{2} 
\end{cases}
$$
​	这样子，我们就只用枚举 $i$ 了，然后，求出在 距离 $i$ 分别为 $A,B,C$ 的 $u,v,w$ 就好了。

​	可惜，我想到这就不会找 $u,v,w$ 了，当时脑子也抽了，还在想着树剖。于是枚举每个链的链顶，然后找 $u,v,w$ ，就成了找其他链中距离它本身链的链顶为 $A,B,C$ 的东西。

​	但时间不够了，于是能运行之后，就没测样例就去打T3。

​	一开始以为T3的subtask多，挺好拿分的，但是，我打的时候，发现一个subtask都没想出来。于是打起了暴力。

​	我的暴力和其他人的略有不同，想到了离线。首先，对于 $x$ 相同的情况，再做一遍太费时间，于是就按 $x$ 为第一关键字， $k$ 为第二关键字，从小打大排序。这样， $x$ 相同的询问必定连在一起，就可以一层一层拓展记贡献；对于 $x$ 不同的，暴力做。

​	中间耗了点时间， 导致我打T3的时候只剩1.5h，打完之后，只剩0.5h。突然发现我T1的正确性是假的，因为那样做要满足 $LCA(u,v)=LCA(u,w)=LCA(v,w)=i$。之后就一直愣着，没有去打T2，卡在怎么保证这个性质。最后5min开始瞎改，然后最后1min CE，直接摆烂不改了。

#### 赛后	

​	好耶，DAY1成绩单出来了，太tmnb了，T1随机撒点有90pts，不过一堆人撒AC了。但还是很开兴，因为DAY1 120pts，就像T1AC了一样。不得不说，裁判NB！多次测试NB！T2果然TLE，真的 $10 \to 20$。

​	盲猜DAY2爆零。

​	TN说自己T1打了3h，然后发现树的直径是错误的，于是最后交了个暴力，样例都没过。这种情况我好像想到了，因为 $u,v,w$ 不一定三点共线，hcy也说被骗了。我当时好像发现了样例都是较小的两个加起来等于最大的，于是没有被骗，但是我CE了呀！

​	听到lwt说自己T1打了80pts的subtask，感觉三等没了，呵呵。

​	中午吃完饭路上买了杯益禾堂，9RMB，小贵。之后再酒店收拾，TN实在太慢了，用机器人送了瓶酒店的农夫山泉，结果过了好久，机器人都下来了，TN还没下来。好像初一的pwx拿了。

​	下午讲题，T1正解前面部分就是我的想法，直接当场emo。后半部分用树状数组维护一些信息，已经没有心情听了，好像和我的想法大相庭径。无语了，😶。

​	T2、T3没有听，后面大家（包括监考员）都说T2、T3挺难的，T2的20pts好像要用FFT，T3正解似乎是树上差分。我太蒟蒻了，不会。

​	中间放那个剪影给我整笑了，hcy独享两秒钟特写。好好笑。

​	然后一直循环播放，再然后就是一些领导发言。终于来到激动人性的跑榜环节。由于赖总已经跟我说过了，按一下空格就会显示当前行的选手第一个有分的没公布的题的成绩。

​	跑榜的时候还会有人飞上去，太刺激了，而且一等、二等、三等线是实时变化的，很紧张。

​	终于来到了铜牌线，之前那堆人好像一堆DAY2爆零的，铜牌线附近的人也是这样子。一堆100pts，我真是又想看见自己的名字又不想，因为在后面的分数比较高，又渴望拿到一个确切的分数。

​	终于看见TN的分数了，DAY1 110pts，DAY2 0pts，看来我离DAY2爆零不远了。TN说自己的DAY1 T3暴力全TLE，似乎没有优化。

​	看见自己的时候，很紧张，因为自己还在铜牌线里面，不过，我DAY2 0pts，所以点到我的时候，我没有动，然后一堆人飞来飞去的，导致分数线不确定， 于是我和TN大喊：“不要再飞了！不要再D飞了！太D了！”。喊得没用。

​	之后就开始颁奖。分了成绩优良奖、成绩优秀奖、成绩优异奖。好家伙，搁着玩文字游戏是吧，一开始我还不知道，贼慌。

​	颁奖好像是铜牌、银牌、金牌的顺序，一开始我不知道铜牌不止一页PPT的人数（一页PPT好像有20个人），所以以为自己没奖。直到后面发现自己在第三页PPT，TN也在。于是我们就开心地去拿奖，拍照。

​	到了银牌线，zzk卡点银牌，laf差一点点，dzr有银牌。wtc直接在飞出银牌线，直接金牌。lzc似乎DAY2打炸了，他明明DAY1 T2 暴打出题人的时间复杂度，没有金牌，只有银牌。

​	金牌纪中一共有4、5个的样子，wtc DAY2 T1 AC，拿到了第七的好成绩。dalao mqz第二，第一好像是广州市第二中学的一个dalao，和mqz拉开了40pts，看来其他学校的OIer也很强啊。

#### 旅游情况

几乎没有。

## 赛后反思

​	这次拿奖全都是靠DAY1 T1骗得分高，不然连奖都没有。所以对于这个的启示就是：**在万不得已的时候，合理利用类似于随机数的东西进行偏分，不然你都不知道你自己能拿几分。**但是这个**不是万能得分**，所以能不这样做就不这样做。

​	DAY1 T2的subtask2想出来了让我挺满意的，这似乎证明了我对数学题有了一点感觉， 虽然不是很多。但是要注意细节，不然那10pts就不会不翼而飞了。

​	DAY1 T3打了暴力，即使在分析错误时间复杂度的情况之下，这个启示是：**要合理分析时间复杂度，要打暴力（即使一分没有）。** 因为这是**对比赛的尊重**。

​	DAY2 T1想出来一点东西，这说明了：**一个OIer的能力是会提升的，要相信自己。**不过这也使得我后面时间不够，直接原地升天，反映我还是要**合理利用时间**，不要在一道题上面卡太久了。而且我T1也没有想**清楚**，后面发现自己的算法的正确性是错误的，心态爆炸。这就说明：**面对一个问题的时候，如果有点眉目，要尽量保证正确性，尽量想清楚一点**。不然可能会GG。

​	DAY2 T3的20pts WA掉我到现在还没想懂，有几方面的因素影响：

1. 时间不足
2. 没写对拍
3. 过于自信

这就说明**写对拍的重要性**，并且，**在考场上，一分也是分，不要放弃每一分，这是OIer应有的态度**。

​	这里写写我应该得分多少分吧。

![3](.\e1.PNG)

​	然而，实际上是这个分数：

![4](.\e2.PNG)

​	原本可以冲银牌的，但是，事情总是违反意愿。

### DAY2 T1 的伪正解

 **声明：这个是TN想出来的，现在我们还是不知道真正的正解是什么，所以请不要轻易尝试。因为没有正确性保证。**

#### 思路

​	首先我们考虑一个事情，我们与其令 $dis(i,u)=A,dis(i,v)=B,dis(i,w)=C$，不妨转化一下， 因为这样太麻烦了，令 $dis(i,u)\ge A,dis(i,v) \ge B,dis(i,w) \ge C$。

​	然后考虑优化一下枚举 $(u,v,w)$ 的过程。基于这样一个事实：如果对于 $i$ 的子树（包括 $i$ ），令最大、次大、第三大的往下的路径长度分别是 $a_i,b_i,c_i$，并且他们**除了起点在 $i$ 中，其余地方不相交 ** ，那么如果 $a_i\ge A,b_i\ge B,c_i\ge C$，我们必定能在以 $i$ 为根的子树中找到合法的 $(u,v,w)$ 。

​	这是正确性的证明。不妨令那三条路径的终点是 $u’,v',w'$，那就有 $dis(i,u')=a_i \ge A,dis(i,v')=b_i\ge B,dis(i,w')=c_i\ge C,LCA(u',v')=LCA(u',w')=LCA(v',w')=i.$这样就满足了一开始的条件，我们顺便把一个无根树转换成了有根树，就不用在顾及以不同的 $i$ 为根的情况下，每次子树的最长路径是不同的。

​	然后就开瞎搞。首先，我们考虑对于单次询问 $x,y,z$ ，我们不妨考虑所有满足 $a_i\ge A$ 的 $i$ 中，找一个 $i'$ 使得 $b_{i'}\ge B,c_{i'}\ge C$。那么，这个 $i'$ 就可以记贡献，具体来讲，就是 $u'_{i'}$ 往上跳 $a_{i'}-A$ 个父亲，$v'_{i'}$ 往上跳 $b_{i'}-B$ 个父亲，$w'_{i'}$ 往上跳 $c_{i'}-C$ 个父亲。这个可以利用倍增实现 $O(\log n)$ 的时间内解决。

​	既然是找一个 $i'$ 使得 $b_{i'}\ge B,c_{i'}\ge C$，我们是不是不用考虑 $b_{i'}$ 具体比 $B$ 大多少，因为最后都可以倍增找到符合的点。 所以，可以在权值线段树中，对于每一个满足 $a_i\ge A$ 的 $i$ 中插入一个位置在 $b_i$ 元素值为 $c_i$ 的元素。然后查找 $c_{j}=\max \{B,n\}$ 的 $j$ 。由于题目保证有解，那么必然满足 $c_j\ge C$ ，所以直接用 $u'_j,v'_j,w'_j$  往上跳。

​	那么对于多次询问，我们思路不变，但是要加两个排序。对所有的节点 $h$ ，按照 $a_h$ 从大到小排序。然后把所有的询问对应的 $A,B,C$ ，进行按照 $A$ 从大到小排序。然后到一次询问 $q_l$ 时，就把所有满足 $a_i\ge q_{l_A}$ 的 $i$ 丢进线段树。

#### 实现细节

​	由于按照 $A$ 从大到小排序了，所以对于两个询问 $q_j,q_k,j>k$ ，在询问 $q_j$ 时丢进线段树的节点可以重复利用。因为有 $j>k \Rightarrow l_{j_A}>l_{k_A}.a_i\ge q_{j_A}\ge q_{k_A}$ 。所以可以重复利用。

​	在找最大值的时候，可以把节点编号和对应元素值绑在一起，毕竟题目要三个具体的值。
